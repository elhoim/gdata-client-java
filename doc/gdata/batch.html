<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Google Data APIs (Beta) Developer's Guide - Batch Processing with Google Data APIs</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link rel="stylesheet" type="text/css" href="../css/dev_docs.css" />
<link rel="stylesheet" type="text/css" href="css/local_extensions.css" />
<!--[if IE 7]>
  <link rel="stylesheet" type="text/css" href="../css/ie7only.css" />
<![endif]-->
<!--[if lte IE 6]>
  <link rel="stylesheet" type="text/css" href="../css/ie6only.css" />
<![endif]-->
<!--[if IE]>
  <link rel="stylesheet" type="text/css" href="../css/ieonly.css" />
<![endif]-->
<style type="text/css">
<!--
h1 a, h2 a, h3 a, h4 a, h5 a, h6 a {
 	color: #000000;
}
-->
</style>
</head>
<body id="batch_page">
<a name="top"></a>
<!-- ########## PAGE HEADER ########## -->
<div id="header">
  <div id="logo"><a href="http://code.google.com/"><img src="http://code.google.com/images/code_sm.png" border="0" alt="Return to Google Code homepage" /></a></div>
  <h1 id="doc_title">Google Data APIs (Beta) Developer's Guide</h1>
</div>
<!-- ########## END PAGE HEADER ########## -->
<div id="wrapper">
  <!-- ########## SIDE NAVIGATION ########## -->
  


  
  
  
  
  
  
  
  
  
  


<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
  _uacct = "UA-18071-1";
  urchinTracker();
</script>

<div id="sidenav">
  <ul>
    <li>
      <h1>GData documentation</h1>
      <ul>
        <!-- ID tag identifies current page -->
        <li><a href="index.html" id="index_link">Main</a></li>
        <li><a href="overview.html" id="overview_link">Overview</a></li>
        <li><a href="basics.html" id="basics_link">Protocol Basics</a></li>
        <li><a href="reference.html" id="reference_link">Protocol Reference</a></li>
        <li><a href="auth.html" id="auth_link">Authentication</a></li>
        <li><a href="elements.html" id="elements_link">Common Elements</a></li>
        <li><a href="clientlibs.html" id="clientlibs_link">Client Libraries</a></li>
        <li><a href="batch.html" id="batch_link">Batch Processing</a></li>
        <li><a href="samples.html" id="samples_link">Samples</a></li>
      </ul>
    </li>
    <li>
      <h1>Service-specific documents</h1>
      <ul>
	
        <li><a href="http://code.google.com/apis/base/">Base Data API</a></li>
	
	
        <li><a href="../blogger/overview.html" id="blogger_link">Blogger Data API</a></li>
	
        <li><a href="../calendar/overview.html" id="calendar_link">Calendar Data API</a></li>
        <li><a href="../codesearch/overview.html" id="codesearch_link">Code Search Data API</a></li>
	
	<li><a href="http://code.google.com/apis/apps/gdata_provisioning_api_v2.0_reference.html">Google Apps Provisioning API</a></li>
	
	
        <li><a href="../notebook/overview.html" id="notebook_link">Notebook Data API</a></li>
	
        <li><a href="../spreadsheets/overview.html" id="spreadsheets_link">Spreadsheets Data API</a></li>
        <li><a href="../picasaweb/overview.html" id="picasaweb_link">Picasa Web Albums Data API</a></li>
      </ul>
    </li>
    <li>
      <h1>Related links</h1>
      <ul><li><a href="http://groups.google.com/group/google-help-dataapi">Discussion Group</a></li>
        <li><a href="http://googledataapis.blogspot.com/">GData Blog</a></li>
      </ul>
    </li>
  </ul>
</div>

  <!-- ########## END SIDE NAVIGATION ########## -->
  <!-- ########## PAGE CONTENT ########## -->
<div id="pagecontent">
    <h1 id="page_title">Batch Processing with Google Data APIs</h1>
    <p>Batch processing gives you the ability to execute multiple operations in one
      request, rather than having to submit each operation individually.</p>
    <p class="note"><strong>Note</strong>: To use the batch functionality, you need to download the latest version of the GData <a href="client-java.html">Java client library</a>.</p>
    <h1>Contents</h1>
    <div class="toc">
    <ol>
      <li><a href="#Audience">Audience</a></li>
      <li><a href="#Introduction">Introduction</a></li>
      <li><a href="#Submit_HTTP">Submitting a batch request</a></li>
      <li><a href="#Writing_Feed">Writing  a batch operations feed</a></li>
      <li><a href="#Handling_Errors">Handling status codes</a></li>
      <li><a href="#Example">Example batch operations and status feeds</a></li>
      <li><a href="#Batch_API">Using the batch functionality of the GData Java client library</a></li>
    </ol>
    </div>
    <h1><a name="Audience" id="Audience">Audience</a></h1>
    <p>This document is intended for programmers who want to submit multiple
      operations in a single request using batch processing.</p>
    <p>This document assumes that you're familiar with using the <a href="client-java.html">GData
      Java client library</a>. The examples in this document show how to use
      the Java client library to run batch operations.</p>
    <p>The examples  in this document are specific to the <a href="../base/">Google Base data
      API</a>. However, other services may also provide batch capabilities.</p>
    <h1><a name="Introduction" id="Introduction">Introduction</a></h1>
    <p>Using a GData batch feed, you can collect multiple insert, update, 
      delete, and query operations, and then submit and execute them all at once.</p>
    <p>For example, the following feed includes four operations:</p>
    <pre>&lt;feed&gt;
  &lt;entry&gt;
    &lt;batch:operation type=&quot;insert&quot;/&gt;
    ... what to insert ...
  &lt;/entry&gt; 
  &lt;entry&gt;
    &lt;batch:operation type=&quot;update&quot;/&gt;
    ... what to update ...
  &lt;/entry&gt;
  &lt;entry&gt;
    &lt;batch:operation type=&quot;delete&quot;/&gt;
    ... what to delete ...
  &lt;/entry&gt;
  &lt;entry&gt;
    &lt;batch:operation type=&quot;query&quot;/&gt;
    ... what to query ...
  &lt;/entry&gt;
&lt;/feed&gt;</pre>
    <p>The service  will
      perform as many of the requested changes as possible and return status information
      that you can use to evaluate the success or failure of each operation.</p>
    <p>The service attempts to execute each
      of the operations within a batch, even if some of the operations included
      in the batch do not succeed.</p>
    <h1><a name="Submit_HTTP" id="Submit_HTTP">Submitting a batch request</a></h1>
    <p>A batch request should be sent as an HTTP POST to a batch URL. Different feeds support different batch operations. Read-only feeds only support queries.</p>
    <p>To discover whether a given feed supports batch operations, you can query
      the feed. If the feed contains a &quot;batch&quot; link 
      relation at the feed level, this indicates that the feed supports 
      batch operations.</p>
    <p>A &quot;batch&quot; link relation is a <code>&lt;link&gt;</code> element with <code>rel=&quot;http://schemas.google.com/g/2005#batch&quot;</code>.  The <code>href</code> attribute of
      the link relation defines the URL where feed documents for batch operations
      may be posted.</p>
    <p>For example, if you execute: <code>GET http://www.google.com/base/feeds/items</code> (the
      regular Google Base &quot;items&quot; 
      feed), you might get the following response:</p>
    <pre>&lt;feed xmlns=...
  &lt;id&gt;http://www.google.com/base/feeds/items&lt;/id&gt;
  &lt;link rel=&quot;http://schemas.google.com/g/2005#feed&quot;
    type=&quot;application/atom+xml&quot;
    href=&quot;http://www.google.com/base/feeds/items&quot;/&gt;
  &lt;link rel=&quot;http://schemas.google.com/g/2005#post&quot;
    type=&quot;application/atom+xml&quot;
    href=&quot;http://www.google.com/base/feeds/items&quot;/&gt;
  <strong>&lt;link rel=&quot;http://schemas.google.com/g/2005#batch&quot;
    type=&quot;application/atom+xml&quot;
    href=&quot;http://www.google.com/base/feeds/items/batch&quot;/&gt;</strong>
  ...
&lt;/feed&gt; 
</pre>
    <p>In this example, the batch URL is <code>http://www.google.com/base/feeds/items/batch</code>.</p>
    <h1><a name="Writing_Feed" id="Writing_Feed">Writing a batch operations feed</a></h1>
    <p>An operations feed contains a list of entries to insert, update, delete, or query.
      Each operation is defined by a <code>&lt;batch:operation type=&quot;insert|update|delete|query&quot;/&gt;</code> element.</p>
    <p>This element may be a direct 
      child of a <code>&lt;feed&gt;</code> element, a direct child of any of the entries in the feed,
      or both. When included in an entry, it specifies the operation to execute
      for that specific entry. When included in the feed, this element specifies
      the default operation to execute on any entries that do not have a <code>&lt;batch:operation/&gt;</code> element.</p>
    <p>When neither the entry nor the feed specifies an operation, the default operation
      is <code>insert</code>.</p>
    <p>Applications should not apply multiple operations to the same entry 
      in a single batch feed. The results are indeterminate if you
      specify multiple operations for the same entry.</p>
    <p>To improve performance, operations may not be processed in the order in which
      they were requested. However, the final result is always  the same as
      if the entries have been processed in order.</p>
    <p>The number of bytes in the XML that you send to the server may not exceed 1 MB (1,048,576 bytes). There are no limits on the number of operations you may request as long as the total byte size does not exceed 1 MB. </p>
    <h2>Insert operations</h2>
    <p>An insert operation is denoted as follows:</p>
    <p><code>&lt;batch:operation type=&quot;insert&quot;&gt;</code></p>
    <p>An insert operation is equivalent to POSTing the entry. When the operation succeeds, the entire entry content is returned, with an updated document id field and a <code>&lt;batch:status code=&quot;201&quot;/&gt;</code> element.</p>
    <p>Here is an example of a successful insert request:</p>
    <pre>&lt;entry&gt;
  &lt;title type=&quot;text&quot;&gt;...&lt;/title&gt;
  &lt;content type=&quot;html&quot;&gt;...&lt;/content&gt;
  <strong>&lt;batch:id&gt;itemA&lt;/batch:id&gt;</strong>
  <strong>&lt;batch:operation type=&quot;insert&quot;/&gt;</strong>
  &lt;g:item_type&gt;recipes&lt;/g:item_type&gt;
  ... 
&lt;/entry&gt;</pre>
    <p>Here is an example of a response to a successful insert request:</p>
    <pre>&lt;entry&gt;
  &lt;batch:status code=&quot;201&quot;/&gt;
  <strong>&lt;batch:id&gt;itemA&lt;/batch:id&gt;
  &lt;batch:operation type=&quot;insert&quot;/&gt;</strong>
  &lt;id&gt;http://www.google.com/base/feeds/items/17437536661927313949&lt;/id&gt;
  &lt;link rel=&quot;self&quot; type=&quot;application/atom+xml&quot;
    href=&quot;http://www.google.com/base/feeds/items/17437536661927313949&quot;/&gt;
  &lt;title type=&quot;text&quot;&gt;...&lt;/title&gt;
  &lt;content type=&quot;html&quot;&gt;...&lt;/content&gt;
  &lt;g:item_type&gt;recipes&lt;/g:item_type&gt;
  ... 
&lt;/entry&gt;</pre>
    <h2>Update operations</h2>
    <p><code>&lt;batch:operation type=&quot;update&quot;&gt;</code></p>
    <p>An update operation is
      equivalent to executing a <code>PUT</code> on the URL referenced by the entry's <code>&lt;id&gt;</code> element. When the operation succeeds, the entire entry content is returned
      with an <code>&lt;batch:status
      code=&quot;200&quot;/&gt;</code> element.</p>
    <p>Here is an example of an update request:</p>
    <pre>&lt;entry&gt;
  &lt;id&gt;http://www.google.com/base/feeds/items/17437536661927313949&lt;/id&gt;
  &lt;batch:operation type=&quot;update&quot;/&gt;
  ...
&lt;/entry&gt;</pre>
    <p>Here is an example of a successful response:</p>
    <pre>&lt;entry&gt;
  &lt;batch:status code=&quot;200&quot;/&gt;
  &lt;id&gt;http://www.google.com/base/feeds/items/17437536661927313949&lt;/id&gt;
  &lt;batch:operation type=&quot;update&quot;/&gt;
  ... 
&lt;/entry&gt;</pre>
    <h2>Delete operations</h2>
    <p><code>&lt;batch:operation type=&quot;delete&quot;&gt;</code></p>
    <p>A delete operation is
      equivalent to executing a <code>DELETE</code> on the URL referenced by by the entry's <code>&lt;id&gt;</code> element. For a
      delete operation, you only need to send a valid entry ID to delete 
      the entry. Any other information you provide in elements that aren't in
      the <code>batch:</code> namespace will be ignored. When the operation succeeds,
      an entry with the same  ID will be returned with a <code>&lt;batch:status
      code=&quot;200&quot;/&gt;</code> element.</p>
    <p>Here is an example of a delete request:</p>
    <pre>&lt;entry&gt;
  &lt;batch:operation type=&quot;delete&quot;/&gt;
  &lt;id&gt;http://www.google.com/base/feeds/items/17437536661927313949&lt;/id&gt;
&lt;/entry&gt;</pre>
    <p>Here is an example of a successful response:</p>
    <pre>&lt;entry&gt;
  &lt;batch:operation type=&quot;delete&quot;/&gt;
  &lt;id&gt;http://www.google.com/base/feeds/items/17437536661927313949&lt;/id&gt;
  &lt;batch:status code=&quot;200&quot; reason=&quot;Success&quot;/&gt;
&lt;/entry&gt;</pre>
    <h2>Query operations</h2>
    <p><code>&lt;batch:operation type=&quot;query&quot;&gt;</code></p>
    <p>A query operation is
      equivalent to executing a <code>GET</code> on the URL referenced by the entry's <code>&lt;id&gt;</code> element. When the operation succeeds, the entire entry content is returned.</p>
    <p>Here is an example of a query request:</p>
    <pre>&lt;entry&gt;
  &lt;id&gt;http://www.google.com/base/feeds/items/1743753666192313949&lt;/id&gt;
  &lt;batch:operation type=&quot;query&quot;/&gt;
&lt;/entry&gt;</pre>
    <p>Here is an example of a successful response:</p>
    <pre>&lt;entry&gt;
  &lt;id&gt;http://www.google.com/base/feeds/items/1743753666192313949&lt;/id&gt;
  &lt;batch:operation type=&quot;query&quot;/&gt;
  &lt;batch:status code=&quot;200&quot; reason=&quot;Success&quot;/&gt;
   ...<em>entry content...</em>
&lt;/entry&gt;</pre>
    <h2><a name="Tracking_Ops" id="Tracking_Ops">Tracking operations</a></h2>
    <p>GData entry results are not necessarily returned in the same order as 
      the request. You can track an operation through its lifetime using an identifier. </p>
    <p>For update, delete, and query operations, you can use the id of the entry itself to track the operation. </p>
    <p>For insert operations, since no ID yet exists, you can pass in an operation identifier. This identifier can be used to 
    link the result entries to the request entries. The operation identifier is passed in the <code>&lt;batch:id&gt;</code> element.</p>
    <p>For each operation, GData returns a response that states whether the operation
      succeeded or failed. Each response identifies the related entry. For an update, delete, or query operation, or a successful insert operation, the entry ID is always returned. If you have specified a batch ID, this is also returned. Since unsuccessful insert operations have no associated entry ID, only the batch ID is returned. </p>
    <p>Using each operation's  identifier, you can retry only the operations
      that failed, rather than having to resubmit the entire batch of operations.</p>
    <p>The content of the <code>&lt;batch:id&gt;</code> is a string value that is client-defined
      and will be echoed back in the corresponding response entry.&nbsp;&nbsp; You
      can specify any value  that will help the client to correlate the response
      with the entry in the original request. This element will be echoed as-is
      in the corresponding entry, even if the operation failed. GData never stores
      nor interprets the content of this batch ID.</p>
    <p>The following example shows a batch operations feed. Notice that the <code>&lt;batch:id&gt;</code> element
      labels this operation as <code>itemB</code>.</p>
    <pre>&lt;entry&gt;
  &lt;title type=&quot;text&quot;&gt;...&lt;/title&gt;
  &lt;content type=&quot;html&quot;&gt;...&lt;/content&gt;
  &lt;batch:id&gt;<strong>itemB</strong>&lt;/batch:id&gt;
  &lt;batch:operation type=&quot;insert&quot;/&gt;
  &lt;g:item_type&gt;recipes&lt;/g:item_type&gt;
&lt;/entry&gt;</pre>
    <p>The following example shows the batch status entry returned in response to
      this operation.</p>
    <pre>&lt;entry&gt;
  &lt;id&gt;http://www.google.com/base/feeds/items/2173859253842813008&lt;/id&gt;
  &lt;published&gt;2006-07-11T14:51:43.560Z&lt;/published&gt;
  &lt;updated&gt;2006-07-11T14:51: 43.560Z&lt;/updated&gt;
  &lt;title type=&quot;text&quot;&gt;...&lt;/title&gt;
  &lt;content type=&quot;html&quot;&gt;...&lt;/content&gt;
  &lt;link rel=&quot;self&quot; 
    type=&quot;application/atom+xml&quot; 
    href=&quot;http://www.google.com/base/feeds/items/2173859253842813008&quot;/&gt;
  &lt;link rel=&quot;edit&quot; 
    type=&quot;application/atom+xml&quot; 
    href=&quot;http://www.google.com/base/feeds/items/2173859253842813008&quot;/&gt;
  &lt;g:item_type&gt;recipes&lt;/g:item_type&gt;
  &lt;batch:operation type=&quot;insert&quot;/&gt;
  &lt;batch:id&gt;<strong>itemB</strong>&lt;/batch:id&gt;
  &lt;batch:status code=&quot;201&quot; reason=&quot;Created&quot;/&gt;
&lt;/entry&gt;</pre>
    <h1><a name="Handling_Errors" id="Handling_Errors">Handling status codes</a></h1>
    <p>Status codes are expressed by the following element:</p>
    <pre>&lt;batch:status code=&quot;200|201|404|500|...&quot; reason=&quot;reason&quot; [content-type=&quot;type&quot;]/&gt;</pre>
    <p>Each entry in the response feed contains one <code>&lt;batch:status&gt;</code> element. This element describes what happened while executing the operation. It mimics the HTTP response that would have been sent if the operation had been sent individually, rather than as part of a batch feed.</p>
    <p>You need to check the <code>&lt;batch:status&gt;</code> element of each entry in the response to find out whether the associated operation was successfully processed. The <code>code=&quot;n&quot;</code> attribute contains a <a href="reference.html#http-status-codes">GData status code</a>.</p>
    <h2>Status descriptions</h2>
    <p>The <code>reason=&quot;reason&quot;</code> attribute of the <code>&lt;batch:status&gt;</code> element contains a more verbose explanation of the operation's status.</p>
    <h2>Content type</h2>
    <p>The <code>content-type=&quot;type&quot;</code> attribute of the <code>&lt;batch:status&gt;</code> element contains the MIME type of the data contained in the <code>&lt;batch:status&gt;</code> element. This corresponds to the <code>Content-Type</code> header of an HTTP status response. This attribute is optional.</p>
    <p>When the content type is set, the body of the <code>&lt;batch:status&gt;</code> element  describes what went wrong while processing the entry.</p>
    <h2>Identifying interrupted operations</h2>
    <p>The <code>&lt;batch:interrupted&gt;</code> element is   inserted only on the feed level, never on the entry level.</p>
    <p>The following element is included in the response for an interrupted operation:</p>
    <p><code>&lt;batch:interrupted reason=&quot;reason&quot; success=&quot;N&quot; failures=&quot;N&quot; parsed=&quot;N&quot;&gt;</code></p>
    <p>This
      element can only appear in the last entry of the feed returned in the body
      of the response. It means that batch processing was interrupted and all attempts
      at recovering the cause of the interruption failed. Some entries might have
      already been processed successfully. All entries that were not reported as
      having succeeded before this point were abandoned.</p>
    <p>This element is very
      unusual and usually signals that the feed sent in the body of the request
      was not in a correct XML format.</p>
    <p>As with  the <code>&lt;batch:status&gt;</code> element, a short
      status code can be found in the <code>reason</code> attribute. A longer response might
      also be found inside the element.</p>
    <h1><a name="Example" id="Example">Example batch operations and status feeds</a></h1>
    <p>Here is a batch operations feed that could be sent to the server. This feed
      requests that the server  delete two entries and add two new entries.</p>
    <pre>POST : http://www.google.com/base/feeds/items/batch
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;feed
  xmlns=&quot;http://www.w3.org/2005/Atom&quot;
  xmlns:openSearch=&quot;http://a9.com/-/spec/opensearchrss/1.0/&quot;
  xmlns:g=&quot;http://base.google.com/ns/1.0&quot;
  xmlns:batch=&quot;http://schemas.google.com/gdata/batch&quot;&gt;
  &lt;title type=&quot;text&quot;&gt;My Batch Feed&lt;/title&gt;
  &lt;entry&gt;
    &lt;id&gt;http://www.google.com/base/feeds/items/13308004346459454600&lt;/id&gt;
    &lt;batch:operation type=&quot;delete&quot;/&gt;
  &lt;/entry&gt;
  &lt;entry&gt;
    &lt;id&gt;http://www.google.com/base/feeds/items/17437536661927313949&lt;/id&gt;
    &lt;batch:operation type=&quot;delete&quot;/&gt;
  &lt;/entry&gt;
  &lt;entry&gt;
    &lt;title type=&quot;text&quot;&gt;...&lt;/title&gt;
    &lt;content type=&quot;html&quot;&gt;...&lt;/content&gt;
    &lt;batch:id&gt;itemA&lt;/batch:id&gt;
    &lt;batch:operation type=&quot;insert&quot;/&gt;
    &lt;g:item_type&gt;recipes&lt;/g:item_type&gt;
  &lt;/entry&gt;
  &lt;entry&gt;
    &lt;title type=&quot;text&quot;&gt;...&lt;/title&gt;
    &lt;content type=&quot;html&quot;&gt;...&lt;/content&gt;
    &lt;batch:id&gt;itemB&lt;/batch:id&gt;
    &lt;batch:operation type=&quot;insert&quot;/&gt;
    &lt;g:item_type&gt;recipes&lt;/g:item_type&gt;
  &lt;/entry&gt;
&lt;/feed&gt;</pre>
    <p>Let's assume that the two insertions worked, but one of the two deletions
      failed. In this case, the batch status feed might look like the following.
      Notice that the entries have been reordered compared to the batch operations
      feed.</p>
    <pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;feed
  xmlns=&quot;http://www.w3.org/2005/Atom&quot;
  xmlns:openSearch=&quot;http://a9.com/-/spec/opensearchrss/1.0/&quot;
  xmlns:g=&quot;http://base.google.com/ns/1.0&quot;
  xmlns:batch=&quot;http://schemas.google.com/gdata/batch&quot;&gt;
  &lt;id&gt;http://www.google.com/base/feeds/items&lt;/id&gt;
  &lt;updated&gt;2006-07-11T14:51:42.894Z&lt;/updated&gt;
  &lt;title type=&quot;text&quot;&gt;My Batch&lt;/title&gt;
  &lt;link rel=&quot;http://schemas.google.com/g/2005#feed&quot;
    type=&quot;application/atom+xml&quot;
    href=&quot;http://www.google.com/base/feeds/items&quot;/&gt;
  &lt;link rel=&quot;http://schemas.google.com/g/2005#post&quot;
    type=&quot;application/atom+xml&quot;
    href=&quot;http://www.google.com/base/feeds/items&quot;/&gt;
  &lt;link rel=&quot; http://schemas.google.com/g/2005#batch&quot;
    type=&quot;application/atom+xml&quot;
    href=&quot;http://www.google.com/base/feeds/items/batch&quot;/&gt;
  &lt;entry&gt;
    &lt;id&gt;http://www.google.com/base/feeds/items/2173859253842813008&lt;/id&gt;
    &lt;published&gt;2006-07-11T14:51:43.560Z&lt;/published&gt;
    &lt;updated&gt;2006-07-11T14:51: 43.560Z&lt;/updated&gt;
    &lt;title type=&quot;text&quot;&gt;...&lt;/title&gt;
    &lt;content type=&quot;html&quot;&gt;...&lt;/content&gt;
    &lt;link rel=&quot;self&quot;
      type=&quot;application/atom+xml&quot;
      href=&quot;http://www.google.com/base/feeds/items/2173859253842813008&quot;/&gt;
    &lt;link rel=&quot;edit&quot;
      type=&quot;application/atom+xml&quot;
      href=&quot;http://www.google.com/base/feeds/items/2173859253842813008&quot;/&gt;
    &lt;g:item_type&gt;recipes&lt;/g:item_type&gt;
    &lt;batch:operation type=&quot;insert&quot;/&gt;
    &lt;batch:id&gt;itemB&lt;/batch:id&gt;
    &lt;batch:status code=&quot;201&quot; reason=&quot;Created&quot;/&gt;
  &lt;/entry&gt;
  &lt;entry&gt;
    &lt;id&gt;http://www.google.com/base/feeds/items/11974645606383737963&lt;/id&gt;
    &lt;published&gt;2006-07-11T14:51:43.247Z&lt;/published&gt;
    &lt;updated&gt;2006-07-11T14:51: 43.247Z&lt;/updated&gt;
    &lt;title type=&quot;text&quot;&gt;...&lt;/title&gt;
    &lt;content type=&quot;html&quot;&gt;...&lt;/content&gt;
    &lt;link rel=&quot;self&quot;
      type=&quot;application/atom+xml&quot;
      href=&quot;http://www.google.com/base/feeds/items/11974645606383737963&quot;/&gt;
    &lt;link rel=&quot;edit&quot;
      type=&quot;application/atom+xml&quot;
      href=&quot;http://www.google.com/base/feeds/items/11974645606383737963&quot;/&gt;
    &lt;g:item_type&gt;recipes&lt;/g:item_type&gt;
    &lt;batch:operation type=&quot;insert&quot;/&gt;
    &lt;batch:id&gt;itemA&lt;/batch:id&gt;
    &lt;batch:status code=&quot;201&quot; reason=&quot;Created&quot;/&gt;
  &lt;/entry&gt;
  &lt;entry&gt;
    &lt;id&gt;http://www.google.com/base/feeds/items/13308004346459454600&lt;/id&gt;
    &lt;updated&gt;2006-07-11T14:51:42.894Z&lt;/updated&gt;
    &lt;title type=&quot;text&quot;&gt;Error&lt;/title&gt;
    &lt;content type=&quot;text&quot;&gt;Bad request&lt;/content&gt;
    &lt;batch:status code=&quot;404&quot;
      reason=&quot;Bad request&quot;
      content-type=&quot;application/xml&quot;&gt;
      &lt;errors&gt;
        &lt;error type=&quot;request&quot; reason=&quot;Cannot find item&quot;/&gt;
      &lt;/errors&gt;
    &lt;/batch:status&gt;
  &lt;/entry&gt;
  &lt;entry&gt;
    &lt;id&gt;http://www.google.com/base/feeds/items/17437536661927313949&lt;/id&gt;
    &lt;updated&gt;2006-07-11T14:51:43.246Z&lt;/updated&gt;
    &lt;content type=&quot;text&quot;&gt;Deleted&lt;/content&gt;
    &lt;batch:operation type=&quot;delete&quot;/&gt;
    &lt;batch:status code=&quot;200&quot; reason=&quot;Success&quot;/&gt;
  &lt;/entry&gt;
&lt;/feed&gt;</pre>
    <h1><a name="Batch_API" id="Batch_API">Using the batch functionality of the GData Java client library</a></h1>
    <p>This section explains how to use the batch functionality of the GData Java
      client library to submit a group of insert, update, and/or delete requests.</p>
    <p>The examples given in this section use the Google Base APIs.</p>
    <p>First import the classes
      you'll need, in addition to the standard GData and Google Base classes:</p>
    <pre>import com.google.gdata.data.batch.*;
import com.google.api.gbase.client.*;</pre>
    <p>To submit a batch request, you need to get the Batch URL from a feed. The
      following code snippet illustrates how to do this, assuming that <code>feed</code> is a <code>GoogleBaseFeed</code> object containing information about a feed:</p>
    <pre>Link batchLink = feed.getLink(Link.Rel.FEED_BATCH, Link.Type.ATOM);
if (batchLink != null) {
  URL batchUrl = new URL(batchLink.getHref());
  ... // batch handling
} else {
  // batching is not supported for this feed
}</pre>
    <p>The following code snippet prepares a feed that will insert two entries in one operation:</p>
    <pre>
GoogleBaseEntry entry1 = new GoogleBaseEntry();
...   // initialize entry 1 content
BatchUtils.setBatchId(entry1, &quot;A&quot;); // A is the local batch ID for this entry
feed.addEntry(entry1);
GoogleBaseEntry entry2 = new GoogleBaseEntry();
... // initialize entry 2 content
BatchUtils.setBatchId(entry2, &quot;B&quot;); // B is the local batch ID for this entry
feed.addEntry(entry2);</pre>
    <p>The code in this example never explicitly states that the operation to be performed for these entries is <code>insert</code>. You don't need to explicitly specify that, because insertion is the default operation.</p>
    <p>To send the batch feed and receive the results, call the <code>Service.batch</code> method.</p>
    <p>Like <code>Service.insert</code>, <code>Service.batch</code> returns the inserted 
        entries with new <code>&lt;atom:id&gt;</code> values set. The returned entries
        are contained in a <code>GoogleBaseFeed</code> object.</p>
    <p>If you want to delete a third entry (which you've already fetched and stored in <code>entry3</code>) at the same time as you insert the other two entries,
      you could use the following code:</p>
    <pre>
GoogleBaseEntry toDelete = new GoogleBaseEntry();


toDelete.setId(entry3.getId());
BatchUtils.setBatchOperationType(toDelete, BatchOperationType.DELETE);

feed.addEntry(toDelete);


GoogleBaseFeed result = service.batch(batchUrl, feed);
</pre>
    <p>Here, <code>service</code> is an instance of <code>com.google.gdata.client.Service</code>.</p>
    <p>If you  want to update an entry, specify <code>OperationType.UPDATE</code>, and initialize
        the entry with the desired changes instead of leaving it mostly
        blank.</p>
    <p>These examples use the Google Base data API. If you are using <code>service.batch</code> with
      another type of GData service, replace the classes <code>GoogleBaseFeed</code>, <code>GoogleBaseEntry</code>, and <code>GoogleBaseService</code> with the appropriate feed, entry, and service classes.</p>
    <p>The results of a batch operation are not necessarily returned in the
      order in which they were requested. In the example above, the result feed might
      very well contain <code>entry2</code> followed by <code>entry1</code>. You should never assume entries
      are returned in any particular order.</p>
    <p>Your batch operations feed should assign a unique batch ID to each insert operation, as explained in <a href="#Tracking_Ops">Tracking operations</a>. In the above examples, the batch IDs are <code>A</code> and <code>B</code>. Therefore, to find the status of the requested operations, you should iterate over the entries in the returned batch feed and compare their batch ID or entry ID, as follows:</p>
    <pre>
for (GoogleBaseEntry entry : result.getEntries()) {
  String batchId = BatchUtils.getBatchId(entry);      
  if (BatchUtils.isSuccess(entry)) {     
    if (&quot;A&quot;.equals(batchId)) {       
      entry1 = entry;     } 
    else if (&quot;B&quot;.equals(batchId)) {       
      entry2 = entry;     } 
    else if (BatchUtils.getBatchOperationType(entry) 
      == BatchOperationType.DELETE) {       
      System.out.println(&quot;Entry &quot; + entry.getId() +
      &quot; has been deleted successfully.&quot;);     
    }      
  } else {     
    BatchStatus status = BatchUtils.getBatchStatus(entry);     
    System.err.println(batchId + &quot; failed (&quot; +                
      status.getReason() + &quot;) &quot; +  status.getContent());      
    }    
  } </pre>
    <p>Each entry you'll find in the returned feed will have an associated <code>BatchStatus</code> object.
      The <code>BatchStatus</code> object contains an HTTP return code and a response
      that describes what went wrong while the entry was processed. You need to
      check the HTTP return code of each entry to tell whether the operation succeeded.</p>
    <p>The check is done in the example above by the convenience method <code>BatchUtils.isSuccess</code>.
      In this case, it is equivalent to: <code>BatchUtils.getBatchStatus(entry) &lt; 300</code>.</p>
    <p>The status codes and responses are further explained in <a href="#Handling_Errors">Handling
      status codes</a>.</p>
    <p class="backtotop"><a href="#top">Back to top</a></p>
  </div>
  <!-- ########## END PAGE CONTENT ########## -->
</div>
<!-- end wrapper -->
<!-- ########## PAGE FOOTER ########## -->
<div id="footer">
  <div id="footerlogo"><img src="http://www.google.com/images/art.gif" alt="" /></div>
  <div id="copyright">
    <p>&copy; Google Inc. 2007 - <a href="http://www.google.com/privacy.html">Privacy Policy</a> - <a href="http://www.google.com/terms_of_service.html">Terms and Conditions</a> - <a href="http://www.google.com/about.html">About Google</a></p>
  </div>
  <!-- end copyright -->
</div>
<!-- ########## END PAGE FOOTER ########## -->
<p id="date">Last modified:
<script type="text/javascript">
  <!--
  var lm = new Date(document.lastModified);
  document.write(lm.toDateString());
  //-->
</script>
</p>
</body>
</html>
