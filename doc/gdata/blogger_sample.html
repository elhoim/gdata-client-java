<html><head>
<script type="text/javascript">
<!--

/**
 * Lists blog entries from the specified JSON feed
 * by creating a new 'ul' element in the DOM.  Each
 * bullet is the title of one blog entry, and contains
 * a hyperlink to that entry's URL.
 *
 * @param {JSON} json is the JSON object pulled from the Blogger service.
 */
function listEntries(json) {
  // Clear any information displayed under the "data" div.
  removeOldResults();
  var ul = document.createElement('ul');

  for (var i = 0; i < json.feed.entry.length; i++) {
    var entry = json.feed.entry[i];
    var alturl;

    for (var k = 0; k < entry.link.length; k++) {
      if (entry.link[k].rel == 'alternate') {
        alturl = entry.link[k].href;
        break;
      }
    }

    var li = document.createElement('li');
    var a = document.createElement('a');
    a.href = alturl;
    a.target = '_blank';

    var txt = document.createTextNode(entry.title.$t);
    a.appendChild(txt);
    li.appendChild(a);

    ul.appendChild(li);
  }

  // Install the bullet list of blog posts.
  document.getElementById('data').appendChild(ul);

  // Re-enable the search button.
  var search_button = document.getElementById('search_button');
  search_button.removeAttribute('disabled');
}

/**
 * Called when the user clicks the 'Search' button to
 * retrieve a blog's JSON feed.  Creates a new script
 * element in the DOM whose source is the JSON feed
 * 'query'.blogspot.com, and specifies that the callback
 * function is 'listEntries' (above).
 *
 * @param {String} query is the blog to be retrieved, specified
 *     as a prefix of ".blogspot.com".
 */
function search(query) {
  // Delete any previous JSON script nodes.
  removeOldJSONScriptNodes();
  // Clear any old data to prepare to display the Loading... message.
  removeOldResults();

  // Show a "Loading..." indicator.
  var div = document.getElementById('data');
  var p = document.createElement('p');
  p.appendChild(document.createTextNode('Loading...'));
  div.appendChild(p);

  // Disable the search button.
  var search_button = document.getElementById('search_button');
  search_button.disabled = 'true';

  // Retrieve the JSON feed.
  var script = document.createElement('script');
  script.setAttribute('src', 'http://' + query + '.blogspot.com/feeds/posts' +
                      '/default?alt=json-in-script&callback=listEntries');
  script.setAttribute('id', 'jsonScript');
  script.setAttribute('type', 'text/javascript');
  document.documentElement.firstChild.appendChild(script);
}

/**
 * Deletes any old script elements which have been created by previous calls
 * to search().
 */
function removeOldJSONScriptNodes() {
  var jsonScript = document.getElementById('jsonScript');
  if (jsonScript) {
    jsonScript.parentNode.removeChild(jsonScript);
  }
}

/**
 * Deletes pre-existing children of the data div from the page. The data div 
 * may contain a "Loading..." message, or the results of a previous query. 
 * This old data should be removed before displaying new data.
 */
function removeOldResults() {
  var div = document.getElementById('data');
  if (div.firstChild) {
    div.removeChild(div.firstChild);
  }
}

//-->
</script>
<link rel="stylesheet" type="text/css" href="../css/dev_docs.css">
</head>
<body>
<h2>Simple example of retrieving JSON feeds from Blogger Data API</h2>
<p><h3>Introduction</h3></p>
<p>This sample demonstrates displaying a list of recent posts from a blog hosted on Blogger Beta using the JSON output format provided by the Blogger Data API.  This allows you to query a blog's public feed and get the resulting entries returned as JSON objects.  To use the new JSON feed, create a script element whose <code>src</code> value is</p>
<p><blockquote><code>http://<b>blogname</b>.blogspot.com/feeds/posts/default?alt=json-in-script&callback=<b>myFunc</b></code></blockquote></p>
<p>where <b><code>blogname</code></b> is the blog you want to retrieve, and <b><code>myFunc</code></b> is the name of your callback function that is passed the JSON object. For more information on JSON output support for Google data APIs please see our <a href="http://code.google.com/apis/gdata/json.html">JSON output support documentation</a>.</p>
<p><b>Note:</b> Retrieving a feed without authentication is only supported for blogs hosted by <a href="http://beta.blogger.com" target="_blank">Blogger Beta</a>.</p>
<p><h3>Demo</h3></p>
<form onsubmit="return false">
<p>Blog: http://<select name="blog_name">
<option>google-code-updates</option>
<option>googlewebtoolkit</option>
<option>googledataapis</option>
<option>googlemapsapi</option>
<option>google-code-featured</option>
<option>googleajaxsearchapi</option>
</select>.blogspot.com&nbsp;
<button id = 'search_button' onclick="search(this.form.blog_name.options[this.form.blog_name.selectedIndex].text);">Search</button>
</p></form>
<div id="data"></div>

</body></html>
