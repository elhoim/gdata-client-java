<html>
<head>
<link rel="stylesheet" type="text/css" 
href="../css/dev_docs.css">
<title>Sample Using Google Base API JSON Output</title>
<script>
<!--
/**
 * Builds an unordered list from the JSON feed entries.
 * This function is the call-back function for the JSON scripts which 
 * executes a Google Base query.
 *
 * @param {JSON} j is the JSON object pulled from the Google Base service.
 */
function listEntries(j) {
  // Clear any information displayed under the "data" div.
  removeOldResults()

  // Transform the JSON results into an unordered list of links.
  var ul = document.createElement("ul");
  for (var i = 0; i < j.feed.entry.length; ++i) {
    var entry = j.feed.entry[i];
    var alturl;
    for (var k = 0; k < entry.link.length; ++k) {
      if (entry.link[k].rel == "alternate") {
        alturl = entry.link[k].href; 
        break;
      }
    }
    var li = document.createElement("li");
    var txt = document.createTextNode(entry.title.$t);

    if (alturl !== undefined) {
      var a = document.createElement("a");
                
      a.href = alturl;
      a.appendChild(txt);
      li.appendChild(a);
    } else {
      li.appendChild(txt);
    }

    ul.appendChild(li);
  }
  document.getElementById("data").appendChild(ul);
}

/**
 * Adds a JSON script element which queries Google Base and calls the 
 * call-back function.
 *
 * @param {DOM object} query The form element containing the input parameters
 *     "bq" and "feed".
 */
function search(query) {
  // Delete any previous Google Base JSON queries.
  removeOldJSONScriptNodes();
  // Clear any old data to prepare to display the Loading... message.
  removeOldResults()

  // Show a "Loading..." indicator.
  var div = document.getElementById('data');
  var p = document.createElement('p');
  p.appendChild(document.createTextNode('Loading...'));
  div.appendChild(p);

  // Add a script element with the src as the user's Google Base query. 
  // JSON output is specified by including the alt=json-in-script argument
  // and the callback funtion is also specified as a URI argument.
  var scriptElement = document.createElement("script");
  scriptElement.setAttribute("id", "jsonScript");
  scriptElement.setAttribute("src", "http://www.google.com/base/feeds/" + 
      query.feed.options[query.feed.selectedIndex].text + "?bq=" + 
      escape(query.bq.value) + "&alt=json-in-script&callback=listEntries");
  scriptElement.setAttribute("type", "text/javascript");
  
  document.documentElement.firstChild.appendChild(scriptElement);
}

/**
 * Deletes any old script elements which have been created by previous calls
 * to search().
 */
function removeOldJSONScriptNodes() {
  var jsonScript = document.getElementById("jsonScript");
  if (jsonScript) {
    jsonScript.parentNode.removeChild(jsonScript);
  }
}

/**
 * Deletes pre-existing children of the data div from the page. The data div 
 * may contain a "Loading..." message, or the results of a previous query. 
 * This old data should be removed before displaying new data.
 */
function removeOldResults() {
  var div = document.getElementById("data");
  if (div.firstChild) {
    div.removeChild(div.firstChild);
  }
}
//-->
</script>
</head>
<body>
<h2>Sample Using Google Base API JSON Output</h2>
<p><h3>Introduction</h3></p>
<p>This example illustrates use of JSON output with the 
<a href="http://code.google.com/apis/base/">Google Base API</a>. On this page,
you can perform a base query against the snippets and attributes feeds. The
same approach can be used to access other Google Base feeds. This query only
returns the first 25 results but you can change this behavior by changing the 
query string. Read more about the 
<a href="http://code.google.com/apis/base/query-lang-spec.html">Google Base 
query language</a> and see what you can come up with!</p>

<p>To use the new JSON feed, create a script element whose <code>src</code> 
value is:</p>
<p><blockquote>
<code>http://www.google.com/base/feeds/<b>feed</b>?bq=<b>query</b>&alt=json-in-script&callback=<b>callBack</b></code>
</blockquote></p>

<p>where <b><code>feed</code></b> is the Google Base feed you wish to query, 
<b><code>query</code></b> is the 
<a href="http://code.google.com/apis/base/query-lang-spec.html">Google Base 
query</a>, and <b><code>callBack</code></b> is the name of the callback 
function that is passed the JSON object. For more information, see the 
complete <a href="http://code.google.com/apis/gdata/json.html">JSON 
documentation</a>.</p>

<p><h3>Demo</h3></p>
<form onSubmit="return false">
<p>Google Base Feed: <select name="feed">
<option>snippets</option>
<option>attributes</option>
</select>
Query: <input type="text" name="bq" value="digital camera">
<button id="search_button" onClick="search(this.form)">Search</button></p>
</form>
<div id="data"></div>
</body>
</html>

